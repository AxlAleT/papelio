flowchart TB
    subgraph "Personalization & History"
        subgraph "Actors"
            authUsers["Authenticated Users"]
        end
        
        subgraph "Search History Tracking"
            SHT1["Log user search queries with timestamps"]
            SHT2["Use SecurityContextHolder to inject user context"]
            SHT1 --> SHT2
        end

        subgraph "Favorites Management"
            FM1["Save/remove articles to a personal list"]
            FM2["Many-to-many relationships in JPA"]
            FM3["Audit fields with @CreatedDate"]
            FM1 --> FM2
            FM2 --> FM3
        end

        subgraph "Personalized Search Suggestions"
            PSS1["Suggest keywords based on user history"]
            PSS2["Store aggregated history data"]
            PSS3["Use Spring @Scheduled for periodic analysis"]
            PSS1 --> PSS2
            PSS2 --> PSS3
        end

        subgraph "Export Saved Articles"
            ESA1["Export favorites/history as CSV/JSON"]
            ESA2["Secure file generation with role checks (@Secured)"]
            ESA1 --> ESA2
        end
    end
    
    %% Connections
    authUsers --> SHT1
    authUsers --> FM1
    authUsers --> PSS1
    authUsers --> ESA1

    classDef section fill:#e6f3ff,stroke:#7fb1d3,stroke-width:2px
    classDef component fill:#f9f9f9,stroke:#ccc,stroke-width:1px

    class authUsers section
    class SHT1,SHT2,FM1,FM2,FM3,PSS1,PSS2,PSS3,ESA1,ESA2 component
